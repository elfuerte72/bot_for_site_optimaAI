# –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

## üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ù–µ–¥–µ–ª—è 1)

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ datetime

**–ü—Ä–æ–±–ª–µ–º–∞:** `TypeError: Object of type datetime is not JSON serializable`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `main.py` - –¥–æ–±–∞–≤–∏—Ç—å custom JSON encoder
- –í—Å–µ endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ datetime

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í main.py
from fastapi.responses import JSONResponse
from datetime import datetime
import json

class DateTimeEncoder(json.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, datetime):
            return obj.isoformat()
        return super().default(obj)

# –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ JSONResponse –Ω–∞:
def create_json_response(content, status_code=200):
    return JSONResponse(
        content=json.loads(json.dumps(content, cls=DateTimeEncoder)),
        status_code=status_code
    )
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Pydantic V2

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `src/config.py`
- `src/models/message.py`
- `src/validators/input_validator.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ó–∞–º–µ–Ω–∏—Ç—å
from pydantic import validator
@validator("field_name")

# –ù–∞
from pydantic import field_validator
@field_validator("field_name")

# –ó–∞–º–µ–Ω–∏—Ç—å
class Config:
    env_file = ".env"

# –ù–∞
model_config = ConfigDict(env_file=".env")
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `tests/test_api.py`
- `tests/test_security.py`

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–∫–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å datetime —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤ —Ç–µ—Å—Ç–∞—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è CORS —Ç–µ—Å—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö

### 4. –ë–∞–∑–æ–≤—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤

**–§–∞–π–ª—ã —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏:**
- `src/models/message.py` - 4 –æ—à–∏–±–∫–∏
- `src/validators/input_validator.py` - 5 –æ—à–∏–±–æ–∫
- `src/config.py` - 3 –æ—à–∏–±–∫–∏

## üî∂ –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ù–µ–¥–µ–ª—è 2)

### 5. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏

**–¶–µ–ª—å:** –î–æ—Å—Ç–∏—á—å 80% –ø–æ–∫—Ä—ã—Ç–∏—è

**–ú–æ–¥—É–ª–∏ —Ç—Ä–µ–±—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤:**

#### `src/services/openai_service.py` (19% ‚Üí 80%)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è `generate_response()`
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è RAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è retry –º–µ—Ö–∞–Ω–∏–∑–º–∞
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è stream response
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è error handling

#### `src/rag/rag_system.py` (25% ‚Üí 80%)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

#### `src/security/config_validator.py` (15% ‚Üí 80%)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è edge cases
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è error scenarios

#### `src/services/cache_service.py` (38% ‚Üí 80%)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∫—ç—à–∞
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è TTL
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏

### 6. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ (22 –Ω–∞—Ä—É—à–µ–Ω–∏—è E501)

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é Black
python -m black src/ --line-length 88

# –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
src/security/config_validator.py:162-252
src/services/openai_service.py:77,85,211
src/validators/input_validator.py:61,109
```

## üî∑ –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ù–µ–¥–µ–ª—è 3)

### 7. –ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ (86 –æ—à–∏–±–æ–∫ MyPy)

**–ü–æ —Ñ–∞–π–ª–∞–º:**

#### `src/middleware/security_headers.py` (15 –æ—à–∏–±–æ–∫)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å Optional —Ç–∏–ø—ã
- [ ] –£–±—Ä–∞—Ç—å unreachable code

#### `src/middleware/sanitization.py` (8 –æ—à–∏–±–æ–∫)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã –¥–ª—è dict/list –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

#### `src/services/openai_service.py` (15 –æ—à–∏–±–æ–∫)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã –¥–ª—è OpenAI API
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è MessageResponse

### 8. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–ù–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- [ ] `tests/test_integration_openai.py`
- [ ] `tests/test_integration_rag.py`
- [ ] `tests/test_integration_middleware.py`
- [ ] `tests/test_integration_security.py`

### 9. –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
- [ ] –£–ª—É—á—à–∏—Ç—å error messages
- [ ] –î–æ–±–∞–≤–∏—Ç—å proper logging –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

## üîπ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ù–µ–¥–µ–ª—è 4+)

### 10. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –ø—Ä–æ–≤–µ—Ä–æ–∫

**–§–∞–π–ª:** `.github/workflows/quality.yml`
```yaml
name: Code Quality
on: [push, pull_request]
jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt
      - name: Run tests with coverage
        run: pytest --cov=src --cov-fail-under=80
      - name: Run flake8
        run: flake8 src/
      - name: Run mypy
        run: mypy src/
      - name: Run black check
        run: black --check src/
```

### 11. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- [ ] `src/monitoring/performance.py`
- [ ] `tests/test_performance.py`

### 12. –£–ª—É—á—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å OpenAPI –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö endpoints
- [ ] –£–ª—É—á—à–∏—Ç—å README.md
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

## –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å ‚úÖ
- [ ] JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- [ ] Pydantic V2 –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ë–∞–∑–æ–≤—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω—ã

### –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å ‚úÖ
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ ‚â• 80%
- [ ] –í—Å–µ E501 –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [ ] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏

### –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å ‚úÖ
- [ ] MyPy –æ—à–∏–±–∫–∏ < 10
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞

### –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å ‚úÖ
- [ ] CI/CD –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏
pytest --cov=src --cov-report=term-missing

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞
flake8 src/ --count --statistics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
mypy src/ --ignore-missing-imports

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
black --check src/

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest tests/ -v

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
bandit -r src/
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –∫–æ–≥–¥–∞:
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (0 failed)
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ ‚â• 80%
- ‚úÖ MyPy –æ—à–∏–±–∫–∏ = 0
- ‚úÖ Flake8 –æ—à–∏–±–∫–∏ = 0
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ security issues –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ CI/CD pipeline –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---
*–ü–ª–∞–Ω —Å–æ–∑–¥–∞–Ω: 2025-06-01*
*–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: Development Team*
*–î–µ–¥–ª–∞–π–Ω: 4 –Ω–µ–¥–µ–ª–∏*