# Деплой исправлений форматирования текста бота

## Что было исправлено

Исправлена проблема с выводом markdown символов в ответах бота. Теперь бот выдает чистый текст без специальных символов и с правильным форматированием списков.

### Изменения в коде:

1. **src/rag/bot_interface.py** - Улучшена функция `_clean_markdown()` и обновлен системный промпт
2. **src/services/openai_service.py** - Добавлена очистка markdown для случаев без RAG
3. **src/config.py** - Обновлен системный промпт по умолчанию

### Пример результата:

**БЫЛО:**
```
1. **Обучение и курсы**: Мы проводим обучающие программы...
2. **Консультации**: У нас есть возможность...
```

**СТАЛО:**
```
1. Обучение и курсы: Мы проводим обучающие программы...

2. Консультации: У нас есть возможность...
```

## Инструкции по деплою

### 1. Проверка изменений локально

```bash
# Перейти в директорию backend
cd /Users/maximpenkin/Documents/openai/site/backend

# Запустить тест очистки markdown
python test_markdown_cleanup.py

# Запустить основное приложение для тестирования
python main.py
```

### 2. Деплой на Heroku

```bash
# Убедиться, что все изменения закоммичены
git add .
git commit -m "fix: улучшена очистка markdown в ответах бота

- Обновлена функция _clean_markdown в bot_interface.py
- Добавлена очистка markdown в openai_service.py  
- Улучшен системный промпт для запрета markdown
- Списки теперь правильно форматируются с отступами"

# Деплой на Heroku
git push heroku main

# Проверить логи деплоя
heroku logs --tail
```

### 3. Проверка работы на продакшене

После деплоя проверить работу бота на сайте optimaai.ru:

1. Задать вопрос боту о услугах компании
2. Убедиться, что в ответе нет символов `**`, `*`, `-`, `#` и т.д.
3. Проверить, что списки отображаются с правильными отступами

### 4. Откат изменений (если нужно)

Если что-то пошло не так:

```bash
# Откатиться к предыдущему коммиту
git reset --hard HEAD~1
git push heroku main --force
```

## Технические детали

### Функция очистки markdown

Функция `_clean_markdown()` теперь:
- Удаляет все markdown символы (`**`, `*`, `_`, `#`, и т.д.)
- Преобразует маркированные списки в абзацы с символом `•`
- Преобразует нумерованные списки в абзацы с номерами
- Добавляет правильные отступы между пунктами
- Нормализует переносы строк

### Системный промпт

Обновленный системный промпт явно запрещает использование markdown:

```
ВАЖНО: Отвечай простым текстом БЕЗ использования markdown разметки.
НЕ используй символы: **, *, __, _, ~~, `, #, -, +, >, |
Если нужно перечислить пункты, используй обычные абзацы с номерами или символом •
Каждый пункт списка должен начинаться с новой строки.
```

## Мониторинг

После деплоя следить за:
- Логами приложения: `heroku logs --tail`
- Ответами бота на сайте
- Отсутствием ошибок в консоли браузера

## Контакты

При возникновении проблем обращаться к разработчику.